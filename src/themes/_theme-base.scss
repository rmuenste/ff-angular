// Theme Base - Common theme definitions and mixins
@use '@angular/material' as mat;

// Base theme mixins that all themes will use
@mixin base-theme($theme) {
  // Include the common styles for Angular Material
  @include mat.all-component-themes($theme);
  
  // Extract theme-specific color palettes
  $color-config: mat.get-color-config($theme);
  $primary: map-get($color-config, 'primary');
  $accent: map-get($color-config, 'accent');
  $warn: map-get($color-config, 'warn');
  $is-dark: map-get($color-config, 'is-dark');
  
  // Define CSS custom properties based on theme
  :root {
    --primary-color: #{mat.get-color-from-palette($primary, 500)};
    --primary-lighter: #{mat.get-color-from-palette($primary, 300)};
    --primary-darker: #{mat.get-color-from-palette($primary, 700)};
    --accent-color: #{mat.get-color-from-palette($accent, 500)};
    --warn-color: #{mat.get-color-from-palette($warn, 500)};
    
    @if $is-dark {
      --background-color: #303030;
      --surface-color: #424242;
      --text-primary: rgba(255, 255, 255, 0.87);
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-disabled: rgba(255, 255, 255, 0.38);
      --divider-color: rgba(255, 255, 255, 0.12);
      // High contrast text for colored backgrounds
      --text-on-primary: rgba(0, 0, 0, 0.87);  // Black text on green
      --text-on-accent: rgba(255, 255, 255, 0.87);  // White text on orange
    } @else {
      --background-color: #fafafa;
      --surface-color: #ffffff;
      --text-primary: rgba(0, 0, 0, 0.87);
      --text-secondary: rgba(0, 0, 0, 0.6);
      --text-disabled: rgba(0, 0, 0, 0.38);
      --divider-color: rgba(0, 0, 0, 0.12);
      // High contrast text for colored backgrounds
      --text-on-primary: rgba(0, 0, 0, 0.87);  // Black text on green
      --text-on-accent: rgba(255, 255, 255, 0.87);  // White text on orange
    }
  }
}

// Custom component theme mixins
@mixin custom-component-themes($theme) {
  $color-config: mat.get-color-config($theme);
  $is-dark: map-get($color-config, 'is-dark');
  
  // Main header component theming
  .main-header {
    background: var(--primary-color);
    color: var(--text-primary);
  }
  
  // Main page component theming
  .main-page {
    background: var(--background-color);
    color: var(--text-primary);
  }
  
  // Navbar theming
  mat-toolbar {
    @if $is-dark {
      box-shadow: 0 3px 5px -1px rgba(0, 0, 0, 0.2),
                  0 6px 10px rgba(0, 0, 0, 0.14),
                  0 1px 18px rgba(0, 0, 0, 0.12);
    } @else {
      box-shadow: 0 3px 5px -1px rgba(0, 0, 0, 0.1),
                  0 6px 10px rgba(0, 0, 0, 0.07),
                  0 1px 18px rgba(0, 0, 0, 0.06);
    }
  }
  
  // Links and interactive elements
  a {
    color: var(--text-primary);
    
    &:hover {
      background: rgba(var(--text-primary), 0.08);
    }
  }
  
  // Definition text styling
  .definition-heading {
    color: var(--text-secondary);
  }
  
  // Override Angular Material component colors to use CSS custom properties
  // This ensures components like mat-tab ink-bar respond to theme switching
  
  // Tab ink bar (tab underline indicator) - MDC classes
  .mat-mdc-tab-group.mat-primary .mdc-tab-indicator__content--underline,
  .mat-mdc-tab-nav-bar.mat-primary .mdc-tab-indicator__content--underline {
    border-color: var(--primary-color) !important;
    background-color: var(--primary-color) !important;
  }
  
  // Tab header styling for proper navigation appearance - MDC classes  
  .mat-mdc-tab-header {
    border-bottom: 1px solid var(--divider-color) !important;
    background: var(--surface-color) !important;
  }
  
  // Tab labels - use proper contrast colors - MDC classes
  .mat-mdc-tab.mdc-tab--active .mdc-tab__text-label {
    color: var(--text-primary) !important;  // Active tab uses primary text color
  }
  
  .mat-mdc-tab:not(.mdc-tab--active) .mdc-tab__text-label {
    color: var(--text-secondary) !important;  // Inactive tabs use secondary text
  }
  
  // Tab body background - MDC classes
  .mat-mdc-tab-body-wrapper {
    background: var(--background-color) !important;
  }
  
  // Other Material components that might need overrides
  .mat-button.mat-primary,
  .mat-icon-button.mat-primary,
  .mat-fab.mat-primary {
    background-color: var(--primary-color) !important;
    color: var(--text-on-primary) !important;
  }
  
  .mat-button.mat-accent,
  .mat-icon-button.mat-accent,
  .mat-fab.mat-accent {
    background-color: var(--accent-color) !important;
    color: var(--text-on-accent) !important;
  }
  
  // Raised buttons
  .mat-raised-button.mat-primary {
    background-color: var(--primary-color) !important;
    color: var(--text-on-primary) !important;
  }
  
  .mat-raised-button.mat-accent {
    background-color: var(--accent-color) !important;
    color: var(--text-on-accent) !important;
  }
  
  // Material drawer/sidenav components
  .mat-drawer,
  .mat-sidenav {
    background: var(--surface-color) !important;
    color: var(--text-primary) !important;
  }
  
  .mat-drawer-container,
  .mat-sidenav-container {
    background: var(--background-color) !important;
    color: var(--text-primary) !important;
  }
  
  // Material list items in drawer
  .mat-drawer .mat-list-item,
  .mat-sidenav .mat-list-item {
    color: var(--text-primary) !important;
  }
  
  // Material table styling for better presentation
  .mat-table {
    .mat-header-cell,
    .mat-cell {
      text-align: center !important;
    }
    
    // Keep identifier/text columns left-aligned for readability
    .mat-column-position,
    .mat-column-case,
    .mat-column-abbreviation,
    .mat-column-name,
    .mat-column-level,
    .mat-column-quantity,
    .mat-column-file,
    .mat-column-action,
    .mat-column-column,
    .mat-column-resolution,
    .mat-column-velocity {
      text-align: left !important;
    }
    
    // For complex tables with descriptive text, keep left alignment
    .mat-cell:first-child {
      text-align: left !important;
    }
  }
  
  // MDC Checkbox theming - ensure proper contrast in all themes
  .mat-mdc-checkbox {
    // Unchecked state border and background
    .mdc-checkbox__native-control:enabled:not(:checked):not(:indeterminate) ~ .mdc-checkbox__background {
      border-color: var(--text-secondary) !important;
      background-color: transparent !important;
    }
    
    // Checked state
    .mdc-checkbox__native-control:enabled:checked ~ .mdc-checkbox__background,
    .mdc-checkbox__native-control:enabled:indeterminate ~ .mdc-checkbox__background {
      border-color: var(--primary-color) !important;
      background-color: var(--primary-color) !important;
    }
    
    // Checkmark color
    .mdc-checkbox__native-control:enabled:checked ~ .mdc-checkbox__background .mdc-checkbox__checkmark,
    .mdc-checkbox__native-control:enabled:indeterminate ~ .mdc-checkbox__background .mdc-checkbox__mixedmark {
      color: var(--text-on-primary) !important;
    }
    
    // Label text color
    .mdc-form-field > label {
      color: var(--text-primary) !important;
    }
    
    // Focus/hover states
    .mdc-checkbox__native-control:enabled:focus ~ .mdc-checkbox__background {
      border-color: var(--primary-color) !important;
    }
  }
  
  // MDC Radio Button theming - ensure proper contrast in all themes
  .mat-mdc-radio-button {
    // Unchecked state outer circle
    .mdc-radio__native-control:enabled:not(:checked) + .mdc-radio__background .mdc-radio__outer-circle {
      border-color: var(--text-secondary) !important;
    }
    
    // Checked state outer circle
    .mdc-radio__native-control:enabled:checked + .mdc-radio__background .mdc-radio__outer-circle {
      border-color: var(--primary-color) !important;
    }
    
    // Checked state inner circle
    .mdc-radio__native-control:enabled:checked + .mdc-radio__background .mdc-radio__inner-circle {
      border-color: var(--primary-color) !important;
      background-color: var(--primary-color) !important;
    }
    
    // Label text color
    .mdc-form-field > label {
      color: var(--text-primary) !important;
    }
    
    // Focus/hover states
    .mdc-radio__native-control:enabled:focus + .mdc-radio__background .mdc-radio__outer-circle {
      border-color: var(--primary-color) !important;
    }
  }
}